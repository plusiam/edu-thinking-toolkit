<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ÌïòÎ≤ÑÎìú ÌîÑÎ°úÏ†ùÌä∏ Ï†úÎ°úÏùò ÏÇ¨Í≥†Í∞ÄÏãúÌôî Ï†ÑÎûµÏùÑ Ï≤¥Í≥ÑÌôîÌïú ÍµêÏú° ÎèÑÍµ¨ Î™®Ïùå">
    <title>üß† ÏÉùÍ∞ÅÏù¥ Î≥¥Ïù¥Îäî ÍµêÏã§ - ÏÇ¨Í≥†Í∞ÄÏãúÌôî ÎèÑÍµ¨ ÌÜµÌï© ÌîåÎû´Ìèº</title>
    
    <!-- PWA Î©îÌÉÄ ÌÉúÍ∑∏ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <link rel="apple-touch-icon" href="assets/images/icon-192.png">
    
    <!-- Ìè∞Ìä∏ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* üé® CSS Î≥ÄÏàò Ï†ïÏùò */
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --stage-1: #FFD93D;
            --stage-2: #FF6B6B;
            --stage-3: #4ECDC4;
            --stage-4: #A8E6CF;
            --bg-light: #f7fafc;
            --bg-dark: #1a202c;
            --text-light: #2d3748;
            --text-dark: #f7fafc;
            --card-light: #ffffff;
            --card-dark: #2d3748;
            --border-light: #e2e8f0;
            --border-dark: #4a5568;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        /* Îã§ÌÅ¨Î™®Îìú */
        [data-theme="dark"] {
            --bg-primary: var(--bg-dark);
            --text-primary: var(--text-dark);
            --card-bg: var(--card-dark);
            --border-color: var(--border-dark);
        }

        [data-theme="light"] {
            --bg-primary: var(--bg-light);
            --text-primary: var(--text-light);
            --card-bg: var(--card-light);
            --border-color: var(--border-light);
        }

        /* Í∏∞Î≥∏ Ïä§ÌÉÄÏùº */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            min-height: 100vh;
        }

        /* Ìó§Îçî */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle, .settings-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .theme-toggle:hover, .settings-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Í≤ÄÏÉâ Î∞î */
        .search-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-bar {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Î∑∞ ÌÜ†Í∏Ä */
        .view-controls {
            max-width: 1400px;
            margin: 0 auto 2rem;
            padding: 0 1rem;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .view-btn {
            padding: 0.5rem 1.5rem;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 2rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ÌïÑÌÑ∞ ÌÉúÍ∑∏ */
        .filter-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-tag {
            padding: 0.3rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-tag:hover {
            transform: scale(1.05);
        }

        .filter-tag.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem 2rem;
            min-height: 60vh;
        }

        /* Îã®Í≥ÑÎ≥Ñ Î∑∞ */
        .stage-view {
            display: grid;
            gap: 2rem;
        }

        .stage-section {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1.5rem;
            border-left: 5px solid;
            transition: var(--transition);
        }

        .stage-section:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .stage-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stage-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .stage-description {
            color: var(--text-primary);
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        /* ÎèÑÍµ¨ Ïπ¥Îìú */
        .tool-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .tool-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .tool-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .tool-name {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.active {
            color: #ffd700;
        }

        .tool-korean-name {
            font-size: 0.9rem;
            color: var(--text-primary);
            opacity: 0.7;
            margin-bottom: 0.5rem;
        }

        .tool-description {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .tool-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 0.5rem;
        }

        .tool-tags {
            display: flex;
            gap: 0.3rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }

        .tool-tag {
            padding: 0.2rem 0.5rem;
            background: var(--bg-primary);
            border-radius: 0.3rem;
            font-size: 0.75rem;
        }

        .tool-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tool-btn {
            flex: 1;
            padding: 0.4rem;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 0.3rem;
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .tool-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Í∑∏Î¶¨Îìú Î∑∞ */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* Î¶¨Ïä§Ìä∏ Î∑∞ */
        .list-view {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .list-view .tool-card {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
        }

        /* ÌÖúÌîåÎ¶ø Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .template-modal .modal-content {
            max-width: 90vw;
            width: 1200px;
            height: 90vh;
        }

        .template-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .template-header {
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .template-iframe {
            flex: 1;
            width: 100%;
            border: none;
            border-radius: 0.5rem;
            background: white;
        }

        .template-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .template-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .template-btn.primary {
            background: var(--primary);
            color: white;
        }

        .template-btn.secondary {
            background: var(--secondary);
            color: white;
        }

        .template-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* ÌÜµÍ≥Ñ Î±ÉÏßÄ */
        .stats-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .stat-badge {
            background: var(--card-bg);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-number {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        /* Î°úÎî© Ïä§ÌîºÎÑà */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Ìë∏ÌÑ∞ */
        .app-footer {
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 2rem 0;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            text-align: center;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .header-container {
                justify-content: center;
                text-align: center;
            }

            .header-title {
                font-size: 1.2rem;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .grid-view {
                grid-template-columns: 1fr;
            }

            .view-toggle {
                justify-content: stretch;
            }

            .view-btn {
                flex: 1;
            }

            .template-modal .modal-content {
                width: 95vw;
                height: 95vh;
            }
        }

        /* Ïù∏ÏáÑ Ïä§ÌÉÄÏùº */
        @media print {
            .app-header, .search-container, .view-controls, .app-footer {
                display: none;
            }

            .tool-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Ìó§Îçî -->
    <header class="app-header">
        <div class="header-container">
            <h1 class="header-title">
                <span>üß†</span>
                <span>ÏÉùÍ∞ÅÏù¥ Î≥¥Ïù¥Îäî ÍµêÏã§</span>
            </h1>
            <div class="header-controls">
                <button class="theme-toggle" onclick="app.toggleTheme()" title="ÌÖåÎßà Î≥ÄÍ≤Ω">
                    <span id="theme-icon">üåô</span>
                </button>
                <button class="settings-btn" onclick="app.openSettings()" title="ÏÑ§Ï†ï">
                    ‚öôÔ∏è
                </button>
            </div>
        </div>
    </header>

    <!-- Í≤ÄÏÉâ -->
    <div class="search-container">
        <input 
            type="search" 
            class="search-bar" 
            placeholder="üîç ÎèÑÍµ¨ Ïù¥Î¶Ñ, Í≥ºÎ™©, ÌÇ§ÏõåÎìúÎ°ú Í≤ÄÏÉâ..."
            oninput="app.searchTools(this.value)"
        >
    </div>

    <!-- Î∑∞ Ïª®Ìä∏Î°§ -->
    <div class="view-controls">
        <div class="view-toggle">
            <button class="view-btn active" onclick="app.setView('stage')">üìä Îã®Í≥ÑÎ≥Ñ</button>
            <button class="view-btn" onclick="app.setView('grid')">‚äû Í∑∏Î¶¨Îìú</button>
            <button class="view-btn" onclick="app.setView('list')">‚ò∞ Î¶¨Ïä§Ìä∏</button>
            <button class="view-btn" onclick="app.setView('subject')">üìö Í≥ºÎ™©Î≥Ñ</button>
            <button class="view-btn" onclick="app.setView('favorites')">‚≠ê Ï¶êÍ≤®Ï∞æÍ∏∞</button>
        </div>
        
        <!-- ÌÜµÍ≥Ñ -->
        <div class="stats-container">
            <div class="stat-badge">
                <span>üîß</span>
                <span>Ï¥ù <span class="stat-number" id="total-tools">17</span>Í∞ú ÎèÑÍµ¨</span>
            </div>
            <div class="stat-badge">
                <span>üìä</span>
                <span><span class="stat-number">4</span>Îã®Í≥Ñ Ï≤¥Í≥Ñ</span>
            </div>
            <div class="stat-badge">
                <span>üìö</span>
                <span><span class="stat-number">8</span>Í∞ú Í≥ºÎ™©</span>
            </div>
        </div>

        <!-- ÌïÑÌÑ∞ ÌÉúÍ∑∏ -->
        <div class="filter-tags" id="filter-tags">
            <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
        </div>
    </div>

    <!-- Î©îÏù∏ ÏΩòÌÖêÏ∏† -->
    <main class="main-content" id="main-content">
        <div class="loading">
            <div class="spinner"></div>
        </div>
    </main>

    <!-- ÎèÑÍµ¨ ÏÉÅÏÑ∏ Î™®Îã¨ -->
    <div class="modal" id="tool-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeModal()">‚úï</button>
            <div id="modal-body">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê® -->
            </div>
        </div>
    </div>

    <!-- ÌÖúÌîåÎ¶ø Î™®Îã¨ -->
    <div class="modal template-modal" id="template-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeTemplateModal()">‚úï</button>
            <div class="template-container">
                <div class="template-header">
                    <h2 id="template-title">ÌÖúÌîåÎ¶ø Î°úÎî© Ï§ë...</h2>
                </div>
                <iframe class="template-iframe" id="template-iframe"></iframe>
                <div class="template-actions">
                    <button class="template-btn primary" onclick="app.printTemplate()">
                        üñ®Ô∏è Ïù∏ÏáÑÌïòÍ∏∞
                    </button>
                    <button class="template-btn secondary" onclick="app.downloadTemplate()">
                        üíæ Îã§Ïö¥Î°úÎìú
                    </button>
                    <button class="template-btn secondary" onclick="app.newWindowTemplate()">
                        üîó ÏÉà Ï∞ΩÏóêÏÑú Ïó¥Í∏∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ìë∏ÌÑ∞ -->
    <footer class="app-footer">
        <div class="footer-content">
            <p>¬© 2025 ÏÉùÍ∞ÅÏù¥ Î≥¥Ïù¥Îäî ÍµêÏã§ | ÌïòÎ≤ÑÎìú ÌîÑÎ°úÏ†ùÌä∏ Ï†úÎ°ú Í∏∞Î∞ò</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">Made with üíù by Î£∞Î£®ÎûÑÎùº ÌïúÍ∏∞Ïå§</p>
        </div>
    </footer>

    <!-- Î©îÏù∏ Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script>
        // üöÄ ÌÜµÌï© Ïï± ÌÅ¥ÎûòÏä§
        class ThinkingToolkitApp {
            constructor() {
                this.state = {
                    tools: [],
                    filteredTools: [],
                    currentView: localStorage.getItem('view') || 'stage',
                    theme: localStorage.getItem('theme') || 'light',
                    favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
                    searchQuery: '',
                    activeFilters: {
                        stage: null,
                        subject: null
                    },
                    isLoading: true,
                    currentTemplate: null
                };
                
                // ÌÖúÌîåÎ¶ø Îß§Ìïë
                this.templates = {
                    'see-think-wonder': 'templates/see-think-wonder.html',
                    'think-puzzle-explore': 'templates/think-puzzle-explore.html',
                    '3-2-1-bridge': 'templates/3-2-1-bridge.html',
                    'frayer-model': 'templates/frayer-model.html',
                    'headlines': 'templates/headlines.html',
                    'csi': 'templates/csi.html',
                    'generate-sort-connect': 'templates/generate-sort-connect.html',
                    'connect-extend-challenge': 'templates/connect-extend-challenge.html',
                    'sentence-phrase-word': 'templates/sentence-phrase-word.html',
                    'orid': 'templates/orid.html',
                    'step-inside': 'templates/step-inside.html',
                    'circle-of-viewpoints': 'templates/circle-of-viewpoints.html',
                    'emotion-weather': 'templates/emotion-weather.html',
                    'abc-thinking': 'templates/abc-thinking.html',
                    'zoom-in': 'templates/zoom-in.html',
                    'chalk-talk': 'templates/chalk-talk.html',
                    'compass-points': 'templates/compass-points.html'
                };
                
                this.init();
            }

            async init() {
                // ÌÖåÎßà Ï†ÅÏö©
                this.applyTheme();
                
                // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                await this.loadData();
                
                // Ï¥àÍ∏∞ Î†åÎçîÎßÅ
                this.render();
                
                // ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù
                this.registerServiceWorker();
            }

            async loadData() {
                try {
                    const response = await fetch('./data/unified-tools.json');
                    const data = await response.json();
                    this.state.tools = data.tools;
                    this.state.filteredTools = data.tools;
                    this.state.stages = data.stages;
                    this.state.subjects = data.subjectRecommendations;
                    this.state.isLoading = false;
                } catch (error) {
                    console.error('Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                    this.showError('Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
            }

            render() {
                if (this.state.isLoading) {
                    return;
                }

                const content = document.getElementById('main-content');
                
                // Î∑∞Ïóê Îî∞Î•∏ Î†åÎçîÎßÅ
                switch(this.state.currentView) {
                    case 'stage':
                        content.innerHTML = this.renderStageView();
                        break;
                    case 'grid':
                        content.innerHTML = this.renderGridView();
                        break;
                    case 'list':
                        content.innerHTML = this.renderListView();
                        break;
                    case 'subject':
                        content.innerHTML = this.renderSubjectView();
                        break;
                    case 'favorites':
                        content.innerHTML = this.renderFavoritesView();
                        break;
                }

                // Î∑∞ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
                this.updateViewButtons();
                
                // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                this.updateStats();
            }

            renderStageView() {
                let html = '<div class="stage-view">';
                
                Object.entries(this.state.stages).forEach(([stageNum, stage]) => {
                    const stageTools = this.state.filteredTools.filter(t => t.stage == stageNum);
                    
                    if (stageTools.length === 0) return;
                    
                    html += `
                        <section class="stage-section" style="border-left-color: ${stage.color}">
                            <div class="stage-header">
                                <span style="font-size: 2rem">${stage.icon}</span>
                                <h2 class="stage-title">${stage.name}</h2>
                            </div>
                            <p class="stage-description">${stage.description}</p>
                            <div class="tools-grid">
                                ${stageTools.map(tool => this.renderToolCard(tool)).join('')}
                            </div>
                        </section>
                    `;
                });
                
                html += '</div>';
                return html;
            }

            renderGridView() {
                return `
                    <div class="grid-view">
                        ${this.state.filteredTools.map(tool => this.renderToolCard(tool)).join('')}
                    </div>
                `;
            }

            renderListView() {
                return `
                    <div class="list-view">
                        ${this.state.filteredTools.map(tool => this.renderToolCard(tool, true)).join('')}
                    </div>
                `;
            }

            renderSubjectView() {
                let html = '<div class="stage-view">';
                
                const subjects = {
                    korean: { name: 'Íµ≠Ïñ¥', icon: 'üìñ', color: '#FF6B6B' },
                    math: { name: 'ÏàòÌïô', icon: 'üìê', color: '#4ECDC4' },
                    science: { name: 'Í≥ºÌïô', icon: 'üî¨', color: '#95E77E' },
                    social: { name: 'ÏÇ¨Ìöå', icon: 'üåç', color: '#FFD93D' },
                    art: { name: 'ÏòàÏà†', icon: 'üé®', color: '#B4A7D6' },
                    ethics: { name: 'ÎèÑÎçï', icon: 'üí≠', color: '#8FA3C0' }
                };
                
                Object.entries(subjects).forEach(([key, subject]) => {
                    const subjectData = this.state.subjects[key];
                    if (!subjectData) return;
                    
                    const subjectTools = this.state.filteredTools.filter(t => 
                        subjectData.recommended.includes(t.id)
                    );
                    
                    if (subjectTools.length === 0) return;
                    
                    html += `
                        <section class="stage-section" style="border-left-color: ${subject.color}">
                            <div class="stage-header">
                                <span style="font-size: 2rem">${subject.icon}</span>
                                <h2 class="stage-title">${subject.name}</h2>
                            </div>
                            <p class="stage-description">${subjectData.description}</p>
                            <div class="tools-grid">
                                ${subjectTools.map(tool => this.renderToolCard(tool)).join('')}
                            </div>
                        </section>
                    `;
                });
                
                html += '</div>';
                return html;
            }

            renderFavoritesView() {
                const favoriteTools = this.state.filteredTools.filter(t => 
                    this.state.favorites.includes(t.id)
                );
                
                if (favoriteTools.length === 0) {
                    return `
                        <div style="text-align: center; padding: 3rem;">
                            <p style="font-size: 3rem; margin-bottom: 1rem;">‚≠ê</p>
                            <p style="font-size: 1.2rem;">ÏïÑÏßÅ Ï¶êÍ≤®Ï∞æÍ∏∞Ìïú ÎèÑÍµ¨Í∞Ä ÏóÜÏäµÎãàÎã§.</p>
                            <p style="margin-top: 0.5rem; opacity: 0.7;">ÎèÑÍµ¨ Ïπ¥ÎìúÏùò Î≥ÑÌëúÎ•º ÌÅ¥Î¶≠ÌïòÏó¨ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî!</p>
                        </div>
                    `;
                }
                
                return `
                    <div class="grid-view">
                        ${favoriteTools.map(tool => this.renderToolCard(tool)).join('')}
                    </div>
                `;
            }

            renderToolCard(tool, isListView = false) {
                const isFavorite = this.state.favorites.includes(tool.id);
                const stage = this.state.stages[tool.stage];
                
                return `
                    <div class="tool-card" data-tool-id="${tool.id}">
                        <div class="tool-header">
                            <div class="tool-name">
                                <span class="tool-icon">${tool.icon}</span>
                                <span>${tool.name}</span>
                            </div>
                            <button 
                                class="favorite-btn ${isFavorite ? 'active' : ''}" 
                                onclick="app.toggleFavorite('${tool.id}')"
                                title="Ï¶êÍ≤®Ï∞æÍ∏∞"
                            >
                                ${isFavorite ? '‚≠ê' : '‚òÜ'}
                            </button>
                        </div>
                        <div class="tool-korean-name">${tool.koreanName}</div>
                        <div class="tool-description">${tool.description}</div>
                        <div class="tool-meta">
                            <span>‚è±Ô∏è ${tool.timeRequired}</span>
                            <span>üë• ${tool.groupSize}</span>
                            <span style="color: ${stage.color}">‚óè ${stage.name}</span>
                        </div>
                        <div class="tool-tags">
                            ${tool.subjects.slice(0, 3).map(s => 
                                `<span class="tool-tag">${s}</span>`
                            ).join('')}
                        </div>
                        <div class="tool-actions">
                            <button class="tool-btn" onclick="app.showToolDetail('${tool.id}')">ÏÉÅÏÑ∏Î≥¥Í∏∞</button>
                            <button class="tool-btn" onclick="app.openTemplate('${tool.id}')">ÌÖúÌîåÎ¶ø</button>
                        </div>
                    </div>
                `;
            }

            showToolDetail(toolId) {
                const tool = this.state.tools.find(t => t.id === toolId);
                if (!tool) return;
                
                const modal = document.getElementById('tool-modal');
                const modalBody = document.getElementById('modal-body');
                const stage = this.state.stages[tool.stage];
                
                modalBody.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <span style="font-size: 3rem">${tool.icon}</span>
                        <div>
                            <h2 style="font-size: 1.5rem; margin-bottom: 0.25rem;">${tool.name}</h2>
                            <p style="opacity: 0.7;">${tool.koreanName}</p>
                        </div>
                    </div>
                    
                    <div style="background: ${stage.color}20; padding: 0.5rem 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <strong>${stage.icon} ${stage.name}</strong>
                    </div>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">üìù ÏÑ§Î™Ö</h3>
                    <p>${tool.description}</p>
                    <p style="margin-top: 0.5rem;">${tool.purpose}</p>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">üìã ÏßÑÌñâ Îã®Í≥Ñ</h3>
                    <ol style="padding-left: 1.5rem;">
                        ${tool.steps.map(step => `<li style="margin: 0.5rem 0;">${step}</li>`).join('')}
                    </ol>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">üí° ÌôúÏö© ÌåÅ</h3>
                    <ul style="padding-left: 1.5rem;">
                        ${tool.tips.map(tip => `<li style="margin: 0.5rem 0;">${tip}</li>`).join('')}
                    </ul>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">üìö Ï†ÅÏö© Í∞ÄÎä• Í≥ºÎ™©</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${tool.subjects.map(s => 
                            `<span style="padding: 0.3rem 0.8rem; background: var(--bg-primary); border-radius: 1rem;">${s}</span>`
                        ).join('')}
                    </div>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">üîó Ïó∞Í¥Ä ÎèÑÍµ¨</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${tool.relatedTools.map(id => {
                            const related = this.state.tools.find(t => t.id === id);
                            return related ? 
                                `<button 
                                    onclick="app.showToolDetail('${id}')" 
                                    style="padding: 0.3rem 0.8rem; background: var(--primary); color: white; border: none; border-radius: 1rem; cursor: pointer;"
                                >
                                    ${related.icon} ${related.name}
                                </button>` : '';
                        }).join('')}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button 
                            onclick="app.openTemplate('${tool.id}')" 
                            style="flex: 1; padding: 0.8rem; background: var(--primary); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;"
                        >
                            ÌÖúÌîåÎ¶ø Ïó¥Í∏∞
                        </button>
                        <button 
                            onclick="app.downloadPDF('${tool.id}')" 
                            style="flex: 1; padding: 0.8rem; background: var(--secondary); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;"
                        >
                            PDF Îã§Ïö¥Î°úÎìú
                        </button>
                    </div>
                `;
                
                modal.classList.add('active');
            }

            closeModal() {
                document.getElementById('tool-modal').classList.remove('active');
            }

            setView(view) {
                this.state.currentView = view;
                localStorage.setItem('view', view);
                this.render();
            }

            updateViewButtons() {
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = Array.from(document.querySelectorAll('.view-btn')).find(btn => 
                    btn.textContent.includes(
                        this.state.currentView === 'stage' ? 'Îã®Í≥ÑÎ≥Ñ' :
                        this.state.currentView === 'grid' ? 'Í∑∏Î¶¨Îìú' :
                        this.state.currentView === 'list' ? 'Î¶¨Ïä§Ìä∏' :
                        this.state.currentView === 'subject' ? 'Í≥ºÎ™©Î≥Ñ' :
                        'Ï¶êÍ≤®Ï∞æÍ∏∞'
                    )
                );
                
                if (activeBtn) activeBtn.classList.add('active');
            }

            searchTools(query) {
                this.state.searchQuery = query.toLowerCase();
                
                if (!query) {
                    this.state.filteredTools = this.state.tools;
                } else {
                    this.state.filteredTools = this.state.tools.filter(tool => {
                        return tool.name.toLowerCase().includes(query) ||
                               tool.koreanName.includes(query) ||
                               tool.description.includes(query) ||
                               tool.subjects.some(s => s.includes(query)) ||
                               tool.steps.some(s => s.includes(query));
                    });
                }
                
                this.render();
            }

            toggleFavorite(toolId) {
                const index = this.state.favorites.indexOf(toolId);
                
                if (index === -1) {
                    this.state.favorites.push(toolId);
                } else {
                    this.state.favorites.splice(index, 1);
                }
                
                localStorage.setItem('favorites', JSON.stringify(this.state.favorites));
                this.render();
            }

            toggleTheme() {
                this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', this.state.theme);
                this.applyTheme();
            }

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.state.theme);
                document.getElementById('theme-icon').textContent = 
                    this.state.theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }

            updateStats() {
                document.getElementById('total-tools').textContent = 
                    this.state.filteredTools.length;
            }

            // ÌÖúÌîåÎ¶ø Í¥ÄÎ†® Ìï®ÏàòÎì§
            openTemplate(toolId) {
                const tool = this.state.tools.find(t => t.id === toolId);
                if (!tool) return;
                
                this.state.currentTemplate = tool;
                
                // ÌÖúÌîåÎ¶ø Î™®Îã¨ Ïó¥Í∏∞
                const modal = document.getElementById('template-modal');
                const iframe = document.getElementById('template-iframe');
                const title = document.getElementById('template-title');
                
                title.textContent = `${tool.icon} ${tool.name} ÌÖúÌîåÎ¶ø`;
                
                // ÌÖúÌîåÎ¶ø HTML ÏÉùÏÑ±
                const templateHTML = this.generateTemplate(tool);
                
                // iframeÏóê ÌÖúÌîåÎ¶ø Î°úÎìú
                iframe.srcdoc = templateHTML;
                
                modal.classList.add('active');
            }

            generateTemplate(tool) {
                // Í∞Å ÎèÑÍµ¨Î≥Ñ ÌÖúÌîåÎ¶ø HTML ÏÉùÏÑ±
                const templates = {
                    'see-think-wonder': this.seeThinkWonderTemplate,
                    'think-puzzle-explore': this.thinkPuzzleExploreTemplate,
                    '3-2-1-bridge': this.bridgeTemplate,
                    // ... Îã§Î•∏ ÌÖúÌîåÎ¶øÎì§
                };

                const templateFunc = templates[tool.id];
                if (templateFunc) {
                    return templateFunc.call(this, tool);
                }
                
                // Í∏∞Î≥∏ ÌÖúÌîåÎ¶ø
                return this.defaultTemplate(tool);
            }

            seeThinkWonderTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tool.name} - ${tool.koreanName}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @page {
            size: A4 landscape;
            margin: 10mm;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: white;
            padding: 20px;
        }
        
        .worksheet {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .student-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .student-info input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .section-icon {
            font-size: 24px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .section-content {
            min-height: 250px;
            background: white;
            border-radius: 4px;
            padding: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            border: none;
            resize: none;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
        }
        
        @media print {
            body {
                padding: 0;
            }
            
            .section {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="worksheet">
        <div class="header">
            <h1>üëÅÔ∏è See - Think - Wonder</h1>
            <p>Î≥¥Í∏∞ - ÏÉùÍ∞ÅÌïòÍ∏∞ - Í∂ÅÍ∏àÌï¥ÌïòÍ∏∞</p>
        </div>
        
        <div class="student-info">
            <input type="text" placeholder="Ïù¥Î¶Ñ">
            <input type="text" placeholder="ÌïôÎÖÑ/Î∞ò">
            <input type="date">
            <input type="text" placeholder="Ï£ºÏ†ú">
        </div>
        
        <div class="content">
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">üëÅÔ∏è</span>
                    <span class="section-title">See (Î≥¥Í∏∞)</span>
                </div>
                <div class="section-content">
                    <textarea placeholder="Î¨¥ÏóáÏùÑ Î≥º Ïàò ÏûàÎÇòÏöî? Í¥ÄÏ∞∞Ìïú Í≤ÉÏùÑ ÏûêÏÑ∏Ìûà Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî."></textarea>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">ü§î</span>
                    <span class="section-title">Think (ÏÉùÍ∞ÅÌïòÍ∏∞)</span>
                </div>
                <div class="section-content">
                    <textarea placeholder="Ïù¥Í≤ÉÏóê ÎåÄÌï¥ Ïñ¥Îñ§ ÏÉùÍ∞ÅÏù¥ ÎìúÎÇòÏöî? Î¨¥ÏóáÏùÑ ÏùòÎØ∏Ìï†ÍπåÏöî?"></textarea>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">‚ùì</span>
                    <span class="section-title">Wonder (Í∂ÅÍ∏àÌï¥ÌïòÍ∏∞)</span>
                </div>
                <div class="section-content">
                    <textarea placeholder="Ïñ¥Îñ§ Ï†êÏù¥ Í∂ÅÍ∏àÌïúÍ∞ÄÏöî? Îçî ÏïåÍ≥† Ïã∂ÏùÄ Í≤ÉÏùÄ Î¨¥ÏóáÏù∏Í∞ÄÏöî?"></textarea>
                </div>
            </div>
        </div>
    </div>
</body>
</html>`;
            }

            thinkPuzzleExploreTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tool.name} - ${tool.koreanName}</title>
    <style>
        /* Ïä§ÌÉÄÏùºÏùÄ See-Think-WonderÏôÄ Ïú†ÏÇ¨ÌïòÍ≤å Íµ¨ÏÑ± */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: white;
            padding: 20px;
        }
        
        .worksheet {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .section {
            background: #fff3e0;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        
        /* ÎÇòÎ®∏ÏßÄ Ïä§ÌÉÄÏùº ÎèôÏùº */
    </style>
</head>
<body>
    <div class="worksheet">
        <div class="header">
            <h1>üß© Think - Puzzle - Explore</h1>
            <p>ÏÉùÍ∞ÅÌïòÍ∏∞ - ÌçºÏ¶ê - ÌÉêÍµ¨ÌïòÍ∏∞</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h3>üí≠ Think (ÏÉùÍ∞ÅÌïòÍ∏∞)</h3>
                <p>Ïù¥ÎØ∏ ÏïåÍ≥† ÏûàÎäî Í≤ÉÏùÄ?</p>
                <textarea></textarea>
            </div>
            
            <div class="section">
                <h3>üß© Puzzle (ÌçºÏ¶ê)</h3>
                <p>Í∂ÅÍ∏àÌïòÍ±∞ÎÇò ÌòºÎûÄÏä§Îü¨Ïö¥ Ï†êÏùÄ?</p>
                <textarea></textarea>
            </div>
            
            <div class="section">
                <h3>üîç Explore (ÌÉêÍµ¨ÌïòÍ∏∞)</h3>
                <p>Ïñ¥ÎñªÍ≤å Îçî ÏïåÏïÑÎ≥ºÍπåÏöî?</p>
                <textarea></textarea>
            </div>
        </div>
    </div>
</body>
</html>`;
            }

            bridgeTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>3-2-1 Bridge</title>
    <!-- ÌÖúÌîåÎ¶ø ÎÇ¥Ïö© -->
</head>
<body>
    <h1>3-2-1 Bridge Template</h1>
    <!-- Íµ¨Ï≤¥Ï†ÅÏù∏ ÌÖúÌîåÎ¶ø ÎÇ¥Ïö© -->
</body>
</html>`;
            }

            defaultTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tool.name} - ${tool.koreanName}</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 400px;
        }
        h1 { margin: 0; }
        h2 { color: #333; margin-top: 20px; }
        .description {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .steps {
            background: white;
            padding: 15px;
            border-radius: 5px;
        }
        .steps ol {
            padding-left: 20px;
        }
        .steps li {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>${tool.icon} ${tool.name}</h1>
        <p>${tool.koreanName}</p>
    </div>
    
    <div class="content">
        <div class="description">
            <h2>üìù ÏÑ§Î™Ö</h2>
            <p>${tool.description}</p>
            <p>${tool.purpose}</p>
        </div>
        
        <div class="steps">
            <h2>üìã ÏßÑÌñâ Îã®Í≥Ñ</h2>
            <ol>
                ${tool.steps.map(step => `<li>${step}</li>`).join('')}
            </ol>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 5px; margin-top: 20px; min-height: 300px;">
            <h2>‚úçÔ∏è ÏûëÏóÖ Í≥µÍ∞Ñ</h2>
            <textarea style="width: 100%; min-height: 250px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; font-family: inherit;"></textarea>
        </div>
    </div>
</body>
</html>`;
            }

            closeTemplateModal() {
                document.getElementById('template-modal').classList.remove('active');
                this.state.currentTemplate = null;
            }

            printTemplate() {
                const iframe = document.getElementById('template-iframe');
                iframe.contentWindow.print();
            }

            downloadTemplate() {
                if (!this.state.currentTemplate) return;
                
                const iframe = document.getElementById('template-iframe');
                const content = iframe.srcdoc;
                
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.state.currentTemplate.id}-template.html`;
                a.click();
                URL.revokeObjectURL(url);
            }

            newWindowTemplate() {
                if (!this.state.currentTemplate) return;
                
                const iframe = document.getElementById('template-iframe');
                const content = iframe.srcdoc;
                
                const newWindow = window.open('', '_blank');
                newWindow.document.write(content);
                newWindow.document.close();
            }

            downloadPDF(toolId) {
                // PDF Îã§Ïö¥Î°úÎìú Í∏∞Îä• (Ï∂îÌõÑ Íµ¨ÌòÑ)
                const tool = this.state.tools.find(t => t.id === toolId);
                if (!tool) return;
                
                alert(`${tool.name} PDF Îã§Ïö¥Î°úÎìú Í∏∞Îä•ÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.`);
            }

            openSettings() {
                alert('ÏÑ§Ï†ï Í∏∞Îä•ÏùÑ Ï§ÄÎπÑ Ï§ëÏûÖÎãàÎã§.');
            }

            showError(message) {
                const content = document.getElementById('main-content');
                content.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <p style="font-size: 3rem; margin-bottom: 1rem;">‚ùå</p>
                        <p style="font-size: 1.2rem;">${message}</p>
                    </div>
                `;
            }

            async registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        await navigator.serviceWorker.register('./service-worker.js');
                        console.log('Service Worker Îì±Î°ù ÏÑ±Í≥µ');
                    } catch (error) {
                        console.log('Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                    }
                }
            }
        }

        // Ïï± Ï¥àÍ∏∞Ìôî
        const app = new ThinkingToolkitApp();
        
        // Ï†ÑÏó≠ Ï†ëÍ∑ºÏùÑ ÏúÑÌï¥ window Í∞ùÏ≤¥Ïóê Ìï†Îãπ
        window.app = app;
    </script>
</body>
</html>