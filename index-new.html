<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="í•˜ë²„ë“œ í”„ë¡œì íŠ¸ ì œë¡œì˜ ì‚¬ê³ ê°€ì‹œí™” ì „ëµì„ ì²´ê³„í™”í•œ êµìœ¡ ë„êµ¬ ëª¨ìŒ">
    <title>ğŸ§  ìƒê°ì´ ë³´ì´ëŠ” êµì‹¤ - ì‚¬ê³ ê°€ì‹œí™” ë„êµ¬ í†µí•© í”Œë«í¼</title>
    
    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <link rel="apple-touch-icon" href="assets/images/icon-192.png">
    
    <!-- í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* ğŸ¨ CSS ë³€ìˆ˜ ì •ì˜ */
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --stage-1: #FFD93D;
            --stage-2: #FF6B6B;
            --stage-3: #4ECDC4;
            --stage-4: #A8E6CF;
            --bg-light: #f7fafc;
            --bg-dark: #1a202c;
            --text-light: #2d3748;
            --text-dark: #f7fafc;
            --card-light: #ffffff;
            --card-dark: #2d3748;
            --border-light: #e2e8f0;
            --border-dark: #4a5568;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        /* ë‹¤í¬ëª¨ë“œ */
        [data-theme="dark"] {
            --bg-primary: var(--bg-dark);
            --text-primary: var(--text-dark);
            --card-bg: var(--card-dark);
            --border-color: var(--border-dark);
        }

        [data-theme="light"] {
            --bg-primary: var(--bg-light);
            --text-primary: var(--text-light);
            --card-bg: var(--card-light);
            --border-color: var(--border-light);
        }

        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            min-height: 100vh;
        }

        /* í—¤ë” */
        .app-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle, .settings-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .theme-toggle:hover, .settings-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        /* ê²€ìƒ‰ ë°” */
        .search-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-bar {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 2rem;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* ë·° í† ê¸€ */
        .view-controls {
            max-width: 1400px;
            margin: 0 auto 2rem;
            padding: 0 1rem;
        }

        .view-toggle {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .view-btn {
            padding: 0.5rem 1.5rem;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 2rem;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .view-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* í•„í„° íƒœê·¸ */
        .filter-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-tag {
            padding: 0.3rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-tag:hover {
            transform: scale(1.05);
        }

        .filter-tag.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem 2rem;
            min-height: 60vh;
        }

        /* ë‹¨ê³„ë³„ ë·° */
        .stage-view {
            display: grid;
            gap: 2rem;
        }

        .stage-section {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 1.5rem;
            border-left: 5px solid;
            transition: var(--transition);
        }

        .stage-section:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .stage-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stage-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .stage-description {
            color: var(--text-primary);
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        /* ë„êµ¬ ì¹´ë“œ */
        .tool-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .tool-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .tool-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .tool-name {
            font-weight: 600;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn.active {
            color: #ffd700;
        }

        .tool-korean-name {
            font-size: 0.9rem;
            color: var(--text-primary);
            opacity: 0.7;
            margin-bottom: 0.5rem;
        }

        .tool-description {
            font-size: 0.9rem;
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .tool-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-bottom: 0.5rem;
        }

        .tool-tags {
            display: flex;
            gap: 0.3rem;
            flex-wrap: wrap;
            margin-bottom: 0.5rem;
        }

        .tool-tag {
            padding: 0.2rem 0.5rem;
            background: var(--bg-primary);
            border-radius: 0.3rem;
            font-size: 0.75rem;
        }

        .tool-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tool-btn {
            flex: 1;
            padding: 0.4rem;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-primary);
            border-radius: 0.3rem;
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .tool-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ê·¸ë¦¬ë“œ ë·° */
        .grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* ë¦¬ìŠ¤íŠ¸ ë·° */
        .list-view {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .list-view .tool-card {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-primary);
        }

        /* í…œí”Œë¦¿ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .template-modal .modal-content {
            max-width: 90vw;
            width: 1200px;
            height: 90vh;
        }

        .template-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .template-header {
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1rem;
        }

        .template-iframe {
            flex: 1;
            width: 100%;
            border: none;
            border-radius: 0.5rem;
            background: white;
        }

        .template-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .template-btn {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .template-btn.primary {
            background: var(--primary);
            color: white;
        }

        .template-btn.secondary {
            background: var(--secondary);
            color: white;
        }

        .template-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* í†µê³„ ë±ƒì§€ */
        .stats-container {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .stat-badge {
            background: var(--card-bg);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-number {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary);
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* í‘¸í„° */
        .app-footer {
            background: var(--card-bg);
            border-top: 1px solid var(--border-color);
            padding: 2rem 0;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
            text-align: center;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header-container {
                justify-content: center;
                text-align: center;
            }

            .header-title {
                font-size: 1.2rem;
            }

            .tools-grid {
                grid-template-columns: 1fr;
            }

            .grid-view {
                grid-template-columns: 1fr;
            }

            .view-toggle {
                justify-content: stretch;
            }

            .view-btn {
                flex: 1;
            }

            .template-modal .modal-content {
                width: 95vw;
                height: 95vh;
            }
        }

        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
        @media print {
            .app-header, .search-container, .view-controls, .app-footer {
                display: none;
            }

            .tool-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="app-header">
        <div class="header-container">
            <h1 class="header-title">
                <span>ğŸ§ </span>
                <span>ìƒê°ì´ ë³´ì´ëŠ” êµì‹¤</span>
            </h1>
            <div class="header-controls">
                <button class="theme-toggle" onclick="app.toggleTheme()" title="í…Œë§ˆ ë³€ê²½">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
                <button class="settings-btn" onclick="app.openSettings()" title="ì„¤ì •">
                    âš™ï¸
                </button>
            </div>
        </div>
    </header>

    <!-- ê²€ìƒ‰ -->
    <div class="search-container">
        <input 
            type="search" 
            class="search-bar" 
            placeholder="ğŸ” ë„êµ¬ ì´ë¦„, ê³¼ëª©, í‚¤ì›Œë“œë¡œ ê²€ìƒ‰..."
            oninput="app.searchTools(this.value)"
        >
    </div>

    <!-- ë·° ì»¨íŠ¸ë¡¤ -->
    <div class="view-controls">
        <div class="view-toggle">
            <button class="view-btn active" onclick="app.setView('stage')">ğŸ“Š ë‹¨ê³„ë³„</button>
            <button class="view-btn" onclick="app.setView('grid')">âŠ ê·¸ë¦¬ë“œ</button>
            <button class="view-btn" onclick="app.setView('list')">â˜° ë¦¬ìŠ¤íŠ¸</button>
            <button class="view-btn" onclick="app.setView('subject')">ğŸ“š ê³¼ëª©ë³„</button>
            <button class="view-btn" onclick="app.setView('favorites')">â­ ì¦ê²¨ì°¾ê¸°</button>
        </div>
        
        <!-- í†µê³„ -->
        <div class="stats-container">
            <div class="stat-badge">
                <span>ğŸ”§</span>
                <span>ì´ <span class="stat-number" id="total-tools">17</span>ê°œ ë„êµ¬</span>
            </div>
            <div class="stat-badge">
                <span>ğŸ“Š</span>
                <span><span class="stat-number">4</span>ë‹¨ê³„ ì²´ê³„</span>
            </div>
            <div class="stat-badge">
                <span>ğŸ“š</span>
                <span><span class="stat-number">8</span>ê°œ ê³¼ëª©</span>
            </div>
        </div>

        <!-- í•„í„° íƒœê·¸ -->
        <div class="filter-tags" id="filter-tags">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <main class="main-content" id="main-content">
        <div class="loading">
            <div class="spinner"></div>
        </div>
    </main>

    <!-- ë„êµ¬ ìƒì„¸ ëª¨ë‹¬ -->
    <div class="modal" id="tool-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeModal()">âœ•</button>
            <div id="modal-body">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </div>
    </div>

    <!-- í…œí”Œë¦¿ ëª¨ë‹¬ -->
    <div class="modal template-modal" id="template-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeTemplateModal()">âœ•</button>
            <div class="template-container">
                <div class="template-header">
                    <h2 id="template-title">í…œí”Œë¦¿ ë¡œë”© ì¤‘...</h2>
                </div>
                <iframe class="template-iframe" id="template-iframe"></iframe>
                <div class="template-actions">
                    <button class="template-btn primary" onclick="app.printTemplate()">
                        ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
                    </button>
                    <button class="template-btn secondary" onclick="app.downloadTemplate()">
                        ğŸ’¾ ë‹¤ìš´ë¡œë“œ
                    </button>
                    <button class="template-btn secondary" onclick="app.newWindowTemplate()">
                        ğŸ”— ìƒˆ ì°½ì—ì„œ ì—´ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="app-footer">
        <div class="footer-content">
            <p>Â© 2025 ìƒê°ì´ ë³´ì´ëŠ” êµì‹¤ | í•˜ë²„ë“œ í”„ë¡œì íŠ¸ ì œë¡œ ê¸°ë°˜</p>
            <p style="margin-top: 0.5rem; opacity: 0.7;">Made with ğŸ’ by ë£°ë£¨ë„ë¼ í•œê¸°ìŒ¤</p>
        </div>
    </footer>

    <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ğŸš€ í†µí•© ì•± í´ë˜ìŠ¤
        class ThinkingToolkitApp {
            constructor() {
                this.state = {
                    tools: [],
                    filteredTools: [],
                    currentView: localStorage.getItem('view') || 'stage',
                    theme: localStorage.getItem('theme') || 'light',
                    favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
                    searchQuery: '',
                    activeFilters: {
                        stage: null,
                        subject: null
                    },
                    isLoading: true,
                    currentTemplate: null
                };
                
                // í…œí”Œë¦¿ ë§¤í•‘
                this.templates = {
                    'see-think-wonder': 'templates/see-think-wonder.html',
                    'think-puzzle-explore': 'templates/think-puzzle-explore.html',
                    '3-2-1-bridge': 'templates/3-2-1-bridge.html',
                    'frayer-model': 'templates/frayer-model.html',
                    'headlines': 'templates/headlines.html',
                    'csi': 'templates/csi.html',
                    'generate-sort-connect': 'templates/generate-sort-connect.html',
                    'connect-extend-challenge': 'templates/connect-extend-challenge.html',
                    'sentence-phrase-word': 'templates/sentence-phrase-word.html',
                    'orid': 'templates/orid.html',
                    'step-inside': 'templates/step-inside.html',
                    'circle-of-viewpoints': 'templates/circle-of-viewpoints.html',
                    'emotion-weather': 'templates/emotion-weather.html',
                    'abc-thinking': 'templates/abc-thinking.html',
                    'zoom-in': 'templates/zoom-in.html',
                    'chalk-talk': 'templates/chalk-talk.html',
                    'compass-points': 'templates/compass-points.html'
                };
                
                this.init();
            }

            async init() {
                // í…Œë§ˆ ì ìš©
                this.applyTheme();
                
                // ë°ì´í„° ë¡œë“œ
                await this.loadData();
                
                // ì´ˆê¸° ë Œë”ë§
                this.render();
                
                // ì„œë¹„ìŠ¤ ì›Œì»¤ ë“±ë¡
                this.registerServiceWorker();
            }

            async loadData() {
                try {
                    const response = await fetch('./data/unified-tools.json');
                    const data = await response.json();
                    this.state.tools = data.tools;
                    this.state.filteredTools = data.tools;
                    this.state.stages = data.stages;
                    this.state.subjects = data.subjectRecommendations;
                    this.state.isLoading = false;
                } catch (error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                    this.showError('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }

            render() {
                if (this.state.isLoading) {
                    return;
                }

                const content = document.getElementById('main-content');
                
                // ë·°ì— ë”°ë¥¸ ë Œë”ë§
                switch(this.state.currentView) {
                    case 'stage':
                        content.innerHTML = this.renderStageView();
                        break;
                    case 'grid':
                        content.innerHTML = this.renderGridView();
                        break;
                    case 'list':
                        content.innerHTML = this.renderListView();
                        break;
                    case 'subject':
                        content.innerHTML = this.renderSubjectView();
                        break;
                    case 'favorites':
                        content.innerHTML = this.renderFavoritesView();
                        break;
                }

                // ë·° ë²„íŠ¼ ì—…ë°ì´íŠ¸
                this.updateViewButtons();
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                this.updateStats();
            }

            renderStageView() {
                let html = '<div class="stage-view">';
                
                Object.entries(this.state.stages).forEach(([stageNum, stage]) => {
                    const stageTools = this.state.filteredTools.filter(t => t.stage == stageNum);
                    
                    if (stageTools.length === 0) return;
                    
                    html += `
                        <section class="stage-section" style="border-left-color: ${stage.color}">
                            <div class="stage-header">
                                <span style="font-size: 2rem">${stage.icon}</span>
                                <h2 class="stage-title">${stage.name}</h2>
                            </div>
                            <p class="stage-description">${stage.description}</p>
                            <div class="tools-grid">
                                ${stageTools.map(tool => this.renderToolCard(tool)).join('')}
                            </div>
                        </section>
                    `;
                });
                
                html += '</div>';
                return html;
            }

            renderGridView() {
                return `
                    <div class="grid-view">
                        ${this.state.filteredTools.map(tool => this.renderToolCard(tool)).join('')}
                    </div>
                `;
            }

            renderListView() {
                return `
                    <div class="list-view">
                        ${this.state.filteredTools.map(tool => this.renderToolCard(tool, true)).join('')}
                    </div>
                `;
            }

            renderSubjectView() {
                let html = '<div class="stage-view">';
                
                const subjects = {
                    korean: { name: 'êµ­ì–´', icon: 'ğŸ“–', color: '#FF6B6B' },
                    math: { name: 'ìˆ˜í•™', icon: 'ğŸ“', color: '#4ECDC4' },
                    science: { name: 'ê³¼í•™', icon: 'ğŸ”¬', color: '#95E77E' },
                    social: { name: 'ì‚¬íšŒ', icon: 'ğŸŒ', color: '#FFD93D' },
                    art: { name: 'ì˜ˆìˆ ', icon: 'ğŸ¨', color: '#B4A7D6' },
                    ethics: { name: 'ë„ë•', icon: 'ğŸ’­', color: '#8FA3C0' }
                };
                
                Object.entries(subjects).forEach(([key, subject]) => {
                    const subjectData = this.state.subjects[key];
                    if (!subjectData) return;
                    
                    const subjectTools = this.state.filteredTools.filter(t => 
                        subjectData.recommended.includes(t.id)
                    );
                    
                    if (subjectTools.length === 0) return;
                    
                    html += `
                        <section class="stage-section" style="border-left-color: ${subject.color}">
                            <div class="stage-header">
                                <span style="font-size: 2rem">${subject.icon}</span>
                                <h2 class="stage-title">${subject.name}</h2>
                            </div>
                            <p class="stage-description">${subjectData.description}</p>
                            <div class="tools-grid">
                                ${subjectTools.map(tool => this.renderToolCard(tool)).join('')}
                            </div>
                        </section>
                    `;
                });
                
                html += '</div>';
                return html;
            }

            renderFavoritesView() {
                const favoriteTools = this.state.filteredTools.filter(t => 
                    this.state.favorites.includes(t.id)
                );
                
                if (favoriteTools.length === 0) {
                    return `
                        <div style="text-align: center; padding: 3rem;">
                            <p style="font-size: 3rem; margin-bottom: 1rem;">â­</p>
                            <p style="font-size: 1.2rem;">ì•„ì§ ì¦ê²¨ì°¾ê¸°í•œ ë„êµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p style="margin-top: 0.5rem; opacity: 0.7;">ë„êµ¬ ì¹´ë“œì˜ ë³„í‘œë¥¼ í´ë¦­í•˜ì—¬ ì¶”ê°€í•˜ì„¸ìš”!</p>
                        </div>
                    `;
                }
                
                return `
                    <div class="grid-view">
                        ${favoriteTools.map(tool => this.renderToolCard(tool)).join('')}
                    </div>
                `;
            }

            renderToolCard(tool, isListView = false) {
                const isFavorite = this.state.favorites.includes(tool.id);
                const stage = this.state.stages[tool.stage];
                
                return `
                    <div class="tool-card" data-tool-id="${tool.id}">
                        <div class="tool-header">
                            <div class="tool-name">
                                <span class="tool-icon">${tool.icon}</span>
                                <span>${tool.name}</span>
                            </div>
                            <button 
                                class="favorite-btn ${isFavorite ? 'active' : ''}" 
                                onclick="app.toggleFavorite('${tool.id}')"
                                title="ì¦ê²¨ì°¾ê¸°"
                            >
                                ${isFavorite ? 'â­' : 'â˜†'}
                            </button>
                        </div>
                        <div class="tool-korean-name">${tool.koreanName}</div>
                        <div class="tool-description">${tool.description}</div>
                        <div class="tool-meta">
                            <span>â±ï¸ ${tool.timeRequired}</span>
                            <span>ğŸ‘¥ ${tool.groupSize}</span>
                            <span style="color: ${stage.color}">â— ${stage.name}</span>
                        </div>
                        <div class="tool-tags">
                            ${tool.subjects.slice(0, 3).map(s => 
                                `<span class="tool-tag">${s}</span>`
                            ).join('')}
                        </div>
                        <div class="tool-actions">
                            <button class="tool-btn" onclick="app.showToolDetail('${tool.id}')">ìƒì„¸ë³´ê¸°</button>
                            <button class="tool-btn" onclick="app.openTemplate('${tool.id}')">í…œí”Œë¦¿</button>
                        </div>
                    </div>
                `;
            }

            showToolDetail(toolId) {
                const tool = this.state.tools.find(t => t.id === toolId);
                if (!tool) return;
                
                const modal = document.getElementById('tool-modal');
                const modalBody = document.getElementById('modal-body');
                const stage = this.state.stages[tool.stage];
                
                modalBody.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <span style="font-size: 3rem">${tool.icon}</span>
                        <div>
                            <h2 style="font-size: 1.5rem; margin-bottom: 0.25rem;">${tool.name}</h2>
                            <p style="opacity: 0.7;">${tool.koreanName}</p>
                        </div>
                    </div>
                    
                    <div style="background: ${stage.color}20; padding: 0.5rem 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <strong>${stage.icon} ${stage.name}</strong>
                    </div>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">ğŸ“ ì„¤ëª…</h3>
                    <p>${tool.description}</p>
                    <p style="margin-top: 0.5rem;">${tool.purpose}</p>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">ğŸ“‹ ì§„í–‰ ë‹¨ê³„</h3>
                    <ol style="padding-left: 1.5rem;">
                        ${tool.steps.map(step => `<li style="margin: 0.5rem 0;">${step}</li>`).join('')}
                    </ol>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">ğŸ’¡ í™œìš© íŒ</h3>
                    <ul style="padding-left: 1.5rem;">
                        ${tool.tips.map(tip => `<li style="margin: 0.5rem 0;">${tip}</li>`).join('')}
                    </ul>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">ğŸ“š ì ìš© ê°€ëŠ¥ ê³¼ëª©</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${tool.subjects.map(s => 
                            `<span style="padding: 0.3rem 0.8rem; background: var(--bg-primary); border-radius: 1rem;">${s}</span>`
                        ).join('')}
                    </div>
                    
                    <h3 style="margin: 1rem 0 0.5rem;">ğŸ”— ì—°ê´€ ë„êµ¬</h3>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        ${tool.relatedTools.map(id => {
                            const related = this.state.tools.find(t => t.id === id);
                            return related ? 
                                `<button 
                                    onclick="app.showToolDetail('${id}')" 
                                    style="padding: 0.3rem 0.8rem; background: var(--primary); color: white; border: none; border-radius: 1rem; cursor: pointer;"
                                >
                                    ${related.icon} ${related.name}
                                </button>` : '';
                        }).join('')}
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button 
                            onclick="app.openTemplate('${tool.id}')" 
                            style="flex: 1; padding: 0.8rem; background: var(--primary); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;"
                        >
                            í…œí”Œë¦¿ ì—´ê¸°
                        </button>
                        <button 
                            onclick="app.downloadPDF('${tool.id}')" 
                            style="flex: 1; padding: 0.8rem; background: var(--secondary); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;"
                        >
                            PDF ë‹¤ìš´ë¡œë“œ
                        </button>
                    </div>
                `;
                
                modal.classList.add('active');
            }

            closeModal() {
                document.getElementById('tool-modal').classList.remove('active');
            }

            setView(view) {
                this.state.currentView = view;
                localStorage.setItem('view', view);
                this.render();
            }

            updateViewButtons() {
                document.querySelectorAll('.view-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = Array.from(document.querySelectorAll('.view-btn')).find(btn => 
                    btn.textContent.includes(
                        this.state.currentView === 'stage' ? 'ë‹¨ê³„ë³„' :
                        this.state.currentView === 'grid' ? 'ê·¸ë¦¬ë“œ' :
                        this.state.currentView === 'list' ? 'ë¦¬ìŠ¤íŠ¸' :
                        this.state.currentView === 'subject' ? 'ê³¼ëª©ë³„' :
                        'ì¦ê²¨ì°¾ê¸°'
                    )
                );
                
                if (activeBtn) activeBtn.classList.add('active');
            }

            searchTools(query) {
                this.state.searchQuery = query.toLowerCase();
                
                if (!query) {
                    this.state.filteredTools = this.state.tools;
                } else {
                    this.state.filteredTools = this.state.tools.filter(tool => {
                        return tool.name.toLowerCase().includes(query) ||
                               tool.koreanName.includes(query) ||
                               tool.description.includes(query) ||
                               tool.subjects.some(s => s.includes(query)) ||
                               tool.steps.some(s => s.includes(query));
                    });
                }
                
                this.render();
            }

            toggleFavorite(toolId) {
                const index = this.state.favorites.indexOf(toolId);
                
                if (index === -1) {
                    this.state.favorites.push(toolId);
                } else {
                    this.state.favorites.splice(index, 1);
                }
                
                localStorage.setItem('favorites', JSON.stringify(this.state.favorites));
                this.render();
            }

            toggleTheme() {
                this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', this.state.theme);
                this.applyTheme();
            }

            applyTheme() {
                document.documentElement.setAttribute('data-theme', this.state.theme);
                document.getElementById('theme-icon').textContent = 
                    this.state.theme === 'light' ? 'ğŸŒ™' : 'â˜€ï¸';
            }

            updateStats() {
                document.getElementById('total-tools').textContent = 
                    this.state.filteredTools.length;
            }

            // í…œí”Œë¦¿ ê´€ë ¨ í•¨ìˆ˜ë“¤
            openTemplate(toolId) {
                const tool = this.state.tools.find(t => t.id === toolId);
                if (!tool) return;
                
                this.state.currentTemplate = tool;
                
                // í…œí”Œë¦¿ ëª¨ë‹¬ ì—´ê¸°
                const modal = document.getElementById('template-modal');
                const iframe = document.getElementById('template-iframe');
                const title = document.getElementById('template-title');
                
                title.textContent = `${tool.icon} ${tool.name} í…œí”Œë¦¿`;
                
                // í…œí”Œë¦¿ HTML ìƒì„±
                const templateHTML = this.generateTemplate(tool);
                
                // iframeì— í…œí”Œë¦¿ ë¡œë“œ
                iframe.srcdoc = templateHTML;
                
                modal.classList.add('active');
            }

            generateTemplate(tool) {
                // ê° ë„êµ¬ë³„ í…œí”Œë¦¿ HTML ìƒì„±
                const templates = {
                    'see-think-wonder': this.seeThinkWonderTemplate,
                    'think-puzzle-explore': this.thinkPuzzleExploreTemplate,
                    '3-2-1-bridge': this.bridgeTemplate,
                    // ... ë‹¤ë¥¸ í…œí”Œë¦¿ë“¤
                };

                const templateFunc = templates[tool.id];
                if (templateFunc) {
                    return templateFunc.call(this, tool);
                }
                
                // ê¸°ë³¸ í…œí”Œë¦¿
                return this.defaultTemplate(tool);
            }

            seeThinkWonderTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tool.name} - ${tool.koreanName}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        @page {
            size: A4 landscape;
            margin: 10mm;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: white;
            padding: 20px;
        }
        
        .worksheet {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .student-info {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .student-info input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .section-icon {
            font-size: 24px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .section-content {
            min-height: 250px;
            background: white;
            border-radius: 4px;
            padding: 15px;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            border: none;
            resize: none;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.6;
        }
        
        @media print {
            body {
                padding: 0;
            }
            
            .section {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="worksheet">
        <div class="header">
            <h1>ğŸ‘ï¸ See - Think - Wonder</h1>
            <p>ë³´ê¸° - ìƒê°í•˜ê¸° - ê¶ê¸ˆí•´í•˜ê¸°</p>
        </div>
        
        <div class="student-info">
            <input type="text" placeholder="ì´ë¦„">
            <input type="text" placeholder="í•™ë…„/ë°˜">
            <input type="date">
            <input type="text" placeholder="ì£¼ì œ">
        </div>
        
        <div class="content">
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">ğŸ‘ï¸</span>
                    <span class="section-title">See (ë³´ê¸°)</span>
                </div>
                <div class="section-content">
                    <textarea placeholder="ë¬´ì—‡ì„ ë³¼ ìˆ˜ ìˆë‚˜ìš”? ê´€ì°°í•œ ê²ƒì„ ìì„¸íˆ ì ì–´ë³´ì„¸ìš”."></textarea>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">ğŸ¤”</span>
                    <span class="section-title">Think (ìƒê°í•˜ê¸°)</span>
                </div>
                <div class="section-content">
                    <textarea placeholder="ì´ê²ƒì— ëŒ€í•´ ì–´ë–¤ ìƒê°ì´ ë“œë‚˜ìš”? ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”?"></textarea>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <span class="section-icon">â“</span>
                    <span class="section-title">Wonder (ê¶ê¸ˆí•´í•˜ê¸°)</span>
                </div>
                <div class="section-content">
                    <textarea placeholder="ì–´ë–¤ ì ì´ ê¶ê¸ˆí•œê°€ìš”? ë” ì•Œê³  ì‹¶ì€ ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?"></textarea>
                </div>
            </div>
        </div>
    </div>
</body>
</html>`;
            }

            thinkPuzzleExploreTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tool.name} - ${tool.koreanName}</title>
    <style>
        /* ìŠ¤íƒ€ì¼ì€ See-Think-Wonderì™€ ìœ ì‚¬í•˜ê²Œ êµ¬ì„± */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: white;
            padding: 20px;
        }
        
        .worksheet {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .section {
            background: #fff3e0;
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
        }
        
        /* ë‚˜ë¨¸ì§€ ìŠ¤íƒ€ì¼ ë™ì¼ */
    </style>
</head>
<body>
    <div class="worksheet">
        <div class="header">
            <h1>ğŸ§© Think - Puzzle - Explore</h1>
            <p>ìƒê°í•˜ê¸° - í¼ì¦ - íƒêµ¬í•˜ê¸°</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h3>ğŸ’­ Think (ìƒê°í•˜ê¸°)</h3>
                <p>ì´ë¯¸ ì•Œê³  ìˆëŠ” ê²ƒì€?</p>
                <textarea></textarea>
            </div>
            
            <div class="section">
                <h3>ğŸ§© Puzzle (í¼ì¦)</h3>
                <p>ê¶ê¸ˆí•˜ê±°ë‚˜ í˜¼ë€ìŠ¤ëŸ¬ìš´ ì ì€?</p>
                <textarea></textarea>
            </div>
            
            <div class="section">
                <h3>ğŸ” Explore (íƒêµ¬í•˜ê¸°)</h3>
                <p>ì–´ë–»ê²Œ ë” ì•Œì•„ë³¼ê¹Œìš”?</p>
                <textarea></textarea>
            </div>
        </div>
    </div>
</body>
</html>`;
            }

            bridgeTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>3-2-1 Bridge</title>
    <!-- í…œí”Œë¦¿ ë‚´ìš© -->
</head>
<body>
    <h1>3-2-1 Bridge Template</h1>
    <!-- êµ¬ì²´ì ì¸ í…œí”Œë¦¿ ë‚´ìš© -->
</body>
</html>`;
            }

            defaultTemplate(tool) {
                return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${tool.name} - ${tool.koreanName}</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        .content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 400px;
        }
        h1 { margin: 0; }
        h2 { color: #333; margin-top: 20px; }
        .description {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .steps {
            background: white;
            padding: 15px;
            border-radius: 5px;
        }
        .steps ol {
            padding-left: 20px;
        }
        .steps li {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>${tool.icon} ${tool.name}</h1>
        <p>${tool.koreanName}</p>
    </div>
    
    <div class="content">
        <div class="description">
            <h2>ğŸ“ ì„¤ëª…</h2>
            <p>${tool.description}</p>
            <p>${tool.purpose}</p>
        </div>
        
        <div class="steps">
            <h2>ğŸ“‹ ì§„í–‰ ë‹¨ê³„</h2>
            <ol>
                ${tool.steps.map(step => `<li>${step}</li>`).join('')}
            </ol>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 5px; margin-top: 20px; min-height: 300px;">
            <h2>âœï¸ ì‘ì—… ê³µê°„</h2>
            <textarea style="width: 100%; min-height: 250px; border: 1px solid #ddd; border-radius: 4px; padding: 10px; font-family: inherit;"></textarea>
        </div>
    </div>
</body>
</html>`;
            }

            closeTemplateModal() {
                document.getElementById('template-modal').classList.remove('active');
                this.state.currentTemplate = null;
            }

            printTemplate() {
                const iframe = document.getElementById('template-iframe');
                iframe.contentWindow.print();
            }

            downloadTemplate() {
                if (!this.state.currentTemplate) return;
                
                const iframe = document.getElementById('template-iframe');
                const content = iframe.srcdoc;
                
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.state.currentTemplate.id}-template.html`;
                a.click();
                URL.revokeObjectURL(url);
            }

            newWindowTemplate() {
                if (!this.state.currentTemplate) return;
                
                const iframe = document.getElementById('template-iframe');
                const content = iframe.srcdoc;
                
                const newWindow = window.open('', '_blank');
                newWindow.document.write(content);
                newWindow.document.close();
            }

            downloadPDF(toolId) {
                // PDF ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (ì¶”í›„ êµ¬í˜„)
                const tool = this.state.tools.find(t => t.id === toolId);
                if (!tool) return;
                
                alert(`${tool.name} PDF ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.`);
            }

            openSettings() {
                alert('ì„¤ì • ê¸°ëŠ¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
            }

            showError(message) {
                const content = document.getElementById('main-content');
                content.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <p style="font-size: 3rem; margin-bottom: 1rem;">âŒ</p>
                        <p style="font-size: 1.2rem;">${message}</p>
                    </div>
                `;
            }

            async registerServiceWorker() {
                if ('serviceWorker' in navigator) {
                    try {
                        await navigator.serviceWorker.register('./service-worker.js');
                        console.log('Service Worker ë“±ë¡ ì„±ê³µ');
                    } catch (error) {
                        console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', error);
                    }
                }
            }
        }

        // ì•± ì´ˆê¸°í™”
        const app = new ThinkingToolkitApp();
        
        // ì „ì—­ ì ‘ê·¼ì„ ìœ„í•´ window ê°ì²´ì— í• ë‹¹
        window.app = app;
    </script>
</body>
</html>